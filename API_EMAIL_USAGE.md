# AugmentCode 脚本 API 邮箱服务使用指南

## 概述

本次更新为 AugmentCode 自动注册脚本添加了两个重要的新功能：

1. **API 邮箱服务** - 通过 API 接口获取邮箱和验证码
2. **自定义上传配置** - 可配置的上传地址，支持变量参数

## 新功能详解

### 1. API 邮箱服务

#### 功能说明
- 支持通过 API 接口获取邮箱地址
- 支持通过 API 接口获取验证码
- 优先级最高，失败时自动回退到其他模式
- 支持多种响应格式的自动解析

#### 配置方法
1. 打开脚本 UI，展开"高级配置"区域
2. 找到"API邮箱服务"配置项
3. 勾选"启用API邮箱模式"
4. 配置以下参数：
   - **获取邮箱API地址**: 返回邮箱地址的 API 接口
   - **获取验证码API地址**: 返回验证码的 API 接口（支持 {email} 变量）

#### API 接口要求

**获取邮箱接口**
- 请求方法: GET
- 响应格式: JSON
- 响应示例:
```json
{
  "email": "test@example.com"
}
```
或
```json
{
  "data": {
    "email": "test@example.com"
  }
}
```
或直接返回邮箱字符串

**获取验证码接口**
- 请求方法: GET
- URL 参数: email（邮箱地址）
- 响应格式: JSON
- 响应示例:
```json
{
  "code": "123456"
}
```
或
```json
{
  "data": {
    "verification_code": "123456"
  }
}
```
或直接返回验证码字符串

#### 使用示例
```
获取邮箱API: https://your-api.com/get-email
获取验证码API: https://your-api.com/get-code?email={email}
```

### 2. 自定义上传配置

#### 功能说明
- 替代默认的 API 提交功能
- 支持自定义上传地址和请求方法
- 支持 URL 中的变量替换
- 支持 POST、PUT、PATCH 请求方法

#### 配置方法
1. 打开脚本 UI，展开"高级配置"区域
2. 找到"自定义上传"配置项
3. 勾选"启用自定义上传"
4. 配置以下参数：
   - **上传地址**: 支持变量的上传 URL
   - **请求方法**: POST/PUT/PATCH

#### 支持的变量
- `{token}`: 个人 Token
- `{augment_token}`: Augment 访问令牌
- `{url}`: 租户 URL

#### 使用示例
```
上传地址: https://your-server.com/upload?token={token}&tenant={url}
请求方法: POST
```

## 工作流程

### 邮箱获取优先级
1. **API 模式** (最高优先级)
   - 如果启用且配置正确，优先使用 API 获取邮箱
   - 失败时自动回退到下一级

2. **预设邮箱模式**
   - 使用用户预先配置的邮箱列表
   - 按顺序使用，用完后回退到随机模式

3. **随机邮箱模式** (默认)
   - 生成随机邮箱地址
   - 使用内置的临时邮箱服务

### 验证码获取优先级
1. **API 模式** (最高优先级)
   - 如果启用且有邮箱参数，优先使用 API 获取验证码
   - 支持多次重试和错误处理

2. **邮箱模式** (回退)
   - 使用传统的邮箱服务获取验证码
   - 支持多种验证码格式的自动识别

## 测试功能

每个新功能都提供了连接测试按钮：

- **测试API邮箱连接**: 验证 API 接口是否正常工作
- **测试自定义上传连接**: 验证上传接口是否可达

## 注意事项

1. **API 接口稳定性**: 确保您的 API 接口稳定可靠
2. **响应格式**: API 响应应符合预期格式，支持多种常见格式
3. **错误处理**: 系统会自动处理 API 失败并回退到其他模式
4. **安全性**: 请确保 API 接口的安全性，避免泄露敏感信息
5. **速率限制**: 注意 API 接口的调用频率限制

## 故障排除

### 常见问题

1. **API 邮箱获取失败**
   - 检查 API 地址是否正确
   - 检查网络连接
   - 查看日志中的详细错误信息

2. **验证码获取失败**
   - 确认邮箱参数正确传递
   - 检查 API 响应格式
   - 验证 {email} 变量是否正确替换

3. **自定义上传失败**
   - 检查上传地址和变量配置
   - 确认服务器接口正常
   - 查看响应状态码和错误信息

### 调试建议

1. 使用"测试连接"功能验证配置
2. 查看脚本日志中的详细信息
3. 检查浏览器开发者工具中的网络请求
4. 确认 API 接口返回的数据格式

### 3. CF验证码自动处理

#### 功能说明
- 自动检测Cloudflare验证码
- 尝试自动点击复选框处理
- 失败时弹窗提示手动操作
- 支持超时保护和用户取消

#### 配置方法
1. 打开脚本 UI，展开"高级配置"区域
2. 找到"CF验证码处理"配置项
3. 配置以下参数：
   - **启用CF验证码自动处理**: 勾选启用
   - **超时时间**: 手动操作等待时间（30-300秒，默认120秒）
   - **自动重试次数**: 自动处理失败前的重试次数（1-10次，默认3次）

#### 工作流程
1. **自动检测**: 脚本检测页面是否存在CF验证码
2. **自动处理**: 尝试自动点击复选框或验证按钮
3. **手动提示**: 自动处理失败时显示弹窗，提示用户手动操作
4. **继续流程**: 用户完成验证后，脚本继续注册流程
5. **超时保护**: 超过设定时间自动取消，避免无限等待

#### 支持的验证码类型
- Cloudflare Turnstile
- CF浏览器验证
- CF挑战页面
- hCaptcha (CF使用的情况)
- 其他常见的CF验证码形式

#### 使用示例
```
☑️ 启用CF验证码自动处理
⏰ 超时时间: 120秒
🔄 自动重试次数: 3次
```

## 更新日志

### v2.6.0 (当前版本)
- ✅ 新增 API 邮箱服务支持
- ✅ 新增自定义上传配置
- ✅ 新增 CF 验证码自动处理功能
- ✅ 优化邮箱和验证码获取流程
- ✅ 增强错误处理和回退机制
- ✅ 添加连接测试功能
- ✅ 改进 UI 配置界面
- ✅ 支持手动操作提示弹窗
- ✅ 添加超时保护机制

---

如有问题或建议，请查看脚本日志或联系开发者。
